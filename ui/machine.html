<html>
    <head>
        <title>La Machine a Tubes</title>
        <meta charset="UTF-8">
    <style>
        
        @font-face {
            font-family: 'NippDo-505';
            src: url('assets/fonts/NipDo-wt505.woff2') format('woff2');
            font-style: normal;
        }

        @font-face {
            font-family: 'NippDo-580';
            src: url('assets/fonts/NipDo-wt580.woff2') format('woff2');
            font-style: normal;
        }
 
        *, *:before, *:after {
            box-sizing: border-box;
        }

        html, body {
            font-family: 'NippDo-505';
            text-transform: uppercase;
            /*font-stretch: 30%;*/
            height: 100vh;
            width: 100vw;
            margin: 0;
            font-size: 3vw;
            overflow: hidden;
        }

        .screen{
            position: absolute;
            top: 0;
            left: 0px;
            width: 50vw;
            height: 50vh;
            transform-origin: 0 0;
            overflow: hidden;
        }

        .vertical{
            width: 50vh;
            height: 50vw;
            transform: rotate(-90deg) translate(-100%);
        }

        .paroles{
            top: 50%;
            display: flex;
            text-align: center;
            justify-content: center;
            align-content: center;
            flex-direction: column;
            color: #5000FF;
            background-color: #AAF9D9;
            font-size: 1.3em;
            line-height: 1.1em;
        }

        #paroles{
            padding: 50px;
        }

        #titre{
            left: 50%;
            display: flex;
            text-align: center;
            justify-content: center;
            align-content: center;
            flex-direction: column;
            color: #AAF9D9;
            background-color: #5000FF;
            
        }

        #titre #grostitre{
            font-family: 'NippDo-580';
            font-size: 1.5em;
            line-height: 1.1em;
            padding-left: 50px;
            padding-right: 50px;
        }

        #titre #infoprenom{
            font-size: 0.8em;
        }
        
        #titre .headertitre{
            position: absolute;
            top: 20px;
            left: 20px;
            width: calc(100% - 40px);
            display: flex;
            justify-content: space-between;
            font-size: 0.6em;
            line-height: 0.9em;
        }

        #titre .footer{
            position: absolute;
            text-align: right;
            right: 20px;
            bottom: 20px;
        }

        #video{
            top: 50%;
            left: 50%;
            display: flex;
            text-align: center;
            justify-content: center;
            align-content: center;
            flex-direction: column;
            background-color: #AAF9D9;
        }

        #video video{
            position: absolute;
            max-width: calc(100% - 100px);
            border: 15px solid #5000FF;
            margin-left: 30px;
            margin-right: auto;
        }

        #video .rotated{
            position: absolute;
            transform-origin: 50% 50%;
            transform: rotate(-90deg) scale(1.82);
            height: 100%;
            width: 100%;
        }

        #infos{
            display: flex;
            text-align: center;
            justify-content: center;
            align-content: center;
            flex-direction: column;
            font-family: 'NippDo-580';
            color: #5000FF;
            background-color: #AAF9D9;
            
        }

        #infos .header{
            font-family: 'NippDo-505';
            background-color: #5000FF;
            color: #AAF9D9;
            line-height: 70%;
            padding-top: 10px;
            padding-bottom: 10px;
            margin-left: 3vh;
            margin-right: 3vh;
        }

        #infos .header::before{
            content: "⬝";
            position: absolute;
            left: 8%;
            line-height: 0.5em;
        }

        #infos .header::after{
            content: "⬝";
            position: absolute;
            right: 8%;
            transform: translate(0, -100%);
            line-height: 0.9em;
        }

        #infos .header span{
            display: block;
            font-size: 0.6em;
        }

        #infos #infonum{
            font-size: 1.4em;
        }

        #infos .info{
            line-height: 1em;
            padding-top: 30px;
            padding-bottom: 30px;
            font-size: 1em;
            font-weight: 700;
            text-transform: uppercase;
            border: 3px solid #5000FF;
            padding-left: 10px;
            padding-right: 10px;
            margin-left: 3vh;
            margin-right: 3vh;
        }

        #infos .footer{
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            display: block;
            font-size: 0.5em;
        }

        .sleep, .loading, .jingle{
            display: none;
            text-align: center;
            justify-content: center;
            align-content: center;
            flex-direction: column;
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: #AAF9D9;
            z-index: 10000;
        }

        .sleep img, .loading img, .jingle img{
            margin-left: auto;
            margin-right: auto;
            max-width: 100%;
            max-height: 100%;
        }

        .vertical .jingle img{
            transform-origin: 50% 50%;
            transform: rotate(90deg) scale(1.80);
        }

        #video video.full{
            max-width: 100%;
            border: 0;
        }
            
    </style>
    </head>
    <body>
        <div class="playcontainer pywebview-drag-region">
            <div class="screen paroles" >
                <div class="sleep"><img src="assets/img/logoinfos.png"></div>
                <div class="loading"><img src="assets/img/loading.gif"></div>
                <div class="jingle"><img src="assets/img/intro_landscape.gif"></div>
                <div id="paroles"></div>
            </div>
            <div class="screen vertical" id="infos" >
                    <div class="sleep"><img src="assets/img/logoinfos.png"></div>
                    <div class="loading"><img src="assets/img/loading.gif"></div>
                    <div class="jingle"><img src="assets/img/intro_portrait.gif"></div>
                    <!-- <div id="infologo"><img src="assets/img/logoinfos.png"></div> -->
                    <div id="infonum">tube #57</div>
                    <div class="header"><span>>Titre</span></div>
                    <div class="info"><span id="infotitre">Lorem Ipsum Dolor Sit Amet</span></div>
                    
                    <div class="header"><span>>Humeur</span></div>
                    <div  class="info"><span id="infoambiance">Joyeuse</span></div>
                    
                    <div class="header"><span>>Tempo</span></div>
                    <div  class="info"><span id="infobpm">BPM</span></div>
                    
                    <div class="header"><span>>Ambiance</span></div>
                    <div class="info"><span  id="infostyle">Tropicale</span></div>
                    <div class="footer">MY NAME IS FUZZY</div>
            </div>
            <div class="screen" id="titre">
                    <div class="sleep"><img src="assets/img/logoinfos.png"></div>
                    <div class="loading"><img src="assets/img/loading.gif"></div>
                    <div class="jingle"><img src="assets/img/intro_landscape.gif"></div>
                    <div class="headertitre"><img src="assets/img/logotitre.png" width="616px" height="51px"><div id="numtube">tube #47</div></div>
                    <div>
                        <div id="grostitre">"UNE DANSE MYSTÉRIEUSE, UNE DANSE MYSTÉRIEUSE"</div>
                        <div id="infoprenom">pour prenom</div>
                    </div>
                    <div class="footer"><img src="assets/img/footertitle.png"></div>
            </div>
            <div class="screen" id="video">
                
                <div class="sleep"><img src="assets/img/logoinfos_90.png"></div>
                <div class="loading"><img src="assets/img/loading_90.gif"></div>
                <video id="jingle_intro" src="assets/videos/machine/intro/intro.mp4" class="full" style="display:none;"></video>
                <video id="dedicacevideo" class="rotated" style="display:none;"></video>
                <video id="jingle_outro" src="assets/videos/machine/jingleout.mp4" class="full" style="display:none;" ></video>
                <video id="outrovideo" style="display:none;" ></video>
            </div>
        </div>
    </body> 
    <script>

        let video = document.querySelector("#video");
        let jingle_intro = document.querySelector("#jingle_intro");
        jingle_intro.load();
        let jingle_outro = document.querySelector("#jingle_outro");
        jingle_outro.load();
        let outro_video = document.querySelector("#outrovideo");
        let dedi_video = document.querySelector("#dedicacevideo");

        var sleep = function(){
            const elems = document.querySelectorAll('.sleep');
            elems.forEach(function(e){
                e.style.display = "flex";
            });
        }

        var wakeup = function(){
            const elems = document.querySelectorAll('.sleep');
            elems.forEach(function(e){
                e.style.display = "none";
            });
        }

        var loading = function(){
            const elems = document.querySelectorAll('.loading');
            elems.forEach(function(e){
                e.style.display = "flex";
            });
        }

        var loaded = function(){
            const elems = document.querySelectorAll('.loading');
            elems.forEach(function(e){
                e.style.display = "none";
            });
        }

        var gointro = function(dedi_url){
            loaded();
            wakeup();
            jingle_intro.play();
            jingle_intro.style.display = "block";
            const elems = document.querySelectorAll('.jingle');
            elems.forEach(function(e){
                e.style.display = "flex";
            });
            dedi_video.src = dedi_url;
            dedi_video.load();
            dedi_video.currentTime = 0;
            jingle_intro.addEventListener("ended", function(v){
                const elems = document.querySelectorAll('.jingle');
                elems.forEach(function(e){
                    e.style.display = "none";
                });
                jingle_intro.style.display = "none";
                dedi_video.play();
                dedi_video.style.display = "block";

                dedi_video.addEventListener("ended", function(v){

                    dedi_video.style.display = "none";
                    window.pywebview.api.videoend();
                });
            });
        };

        var gooutro = function(outro_url){
            const vids = document.querySelectorAll('video');
            vids.forEach(function(v){
                v.style.display = "none";
            });
            clearclipvids();
            jingle_outro.play();
            jingle_outro.style.display = "block";
            outro_video.src = outro_url;
            outro_video.load();
            const elems = document.querySelectorAll('.jingle');
            elems.forEach(function(e){
                e.style.display = "flex";
            });
            jingle_outro.addEventListener("ended", function(v){
                jingle_outro.style.display = "none";
                outro_video.play();
                outro_video.style.display = "block";
                outro_video.addEventListener("ended", function(v){
                    const elems = document.querySelectorAll('.jingle');
                    elems.forEach(function(e){
                        e.style.display = "none";
                    });
                    outro_video.style.display = "none";
                    window.pywebview.api.videoend();
                    sleep();
                });
            });
        };

        var displaylyrics = function(text, pos){
            console.log("display " + text + " @ " + pos);
            lyrics = document.querySelector("#" + pos);
            lyrics.innerHTML = text;
        };
        
        var displayinfos = function(name, numero, ambiance, style, bpm, prenom){
            console.log(prenom)
            document.querySelector("#infotitre").innerHTML = name;
            document.querySelector("#grostitre").innerHTML = name;
            document.querySelector("#infoambiance").innerHTML = ambiance;
            document.querySelector("#infostyle").innerHTML = style;
            document.querySelector("#infobpm").innerHTML = bpm;
            document.querySelector("#infoprenom").innerHTML = "pour " + prenom;
            document.querySelector("#numtube").innerHTML = "Chanson #" + numero;
            document.querySelector("#infonum").innerHTML = "Chanson #" + numero;
        };

        var preloadvid = function(source){
            if(document.querySelector("video[src='" + source + "']") == null){
                console.log("loading " + source);
                let vid = document.createElement("video");
                vid.preload = "auto";
                vid.src = source;
                vid.muted = true;
                vid.loop = true;
                vid.classList.add("clipvid");
                vid.style.position = "absolute";
                vid.addEventListener("ended", function(e){
                    vid.style.display = "none";
                });
                /*vid.addEventListener("canplaythrough", function(e){
                    console.log("I can play " + source);
                });*/
                video.appendChild(vid);
                vid.load();
                vid.play();
                vid.style.display="none";
            }
        }

        var clearclipvids = function(){
            const vids = document.querySelectorAll('video.clipvid');

            vids.forEach(function(v){
                v.pause();
                v.src = "";
                v.remove();
            });
        }

        var playvid = function(source){
            if(source == "") return;
            const vids = document.querySelectorAll('video');
            let vid = document.querySelector("video[src='" + source + "']");

            vids.forEach(function(v){
                if(v!==vid) v.style.display = "none";
            });
            vid.style.display = "block";            
            //vid.play();
            //vid.currentTime = 1;
            //setTimeOut( function(){}, 200);
        };

        sleep();

    </script>
</html>